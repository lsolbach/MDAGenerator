<project name="MDAGenerator" default="distribute">
	
	<property environment="env"/>
	<property file="build.properties"/>
	<property name="common.build.dir" value="${env.COMMON_BUILD_HOME}"/>
	
	<!-- import common build files -->
	<import file="${common.build.dir}/ant/common.properties.xml"/>
	<import file="${common.build.dir}/ant/common.build.xml"/>

	<property file="${lib.dir}/version.properties"/>
	
	<!--
	  -  project specific
	  -->
	<property name="model.dir" location="model"/>
	<path id="gen.classpath">
		<pathelement location="${build.dir}"/>
		<path refid="compile.classpath"/>
	</path>

	<target name="mdaGenerator" depends="compile">
		<taskdef name="mdaGenerator" classname="org.soulspace.mda.generator.ant.MdaGeneratorTask">
			<classpath refid="gen.classpath"/>
		</taskdef>
	
		<!-- make a backup of the generated files -->
		<copy todir="${backup.dir}" overwrite="true">
			<fileset dir="${generate.dir}"/>
		</copy>
		
		<!-- delete generation dir -->
		<delete>
			<fileset dir="${generate.dir}"/>
		</delete>
		
		<!-- call generator -->
		<mdaGenerator destDir="${generate.dir}"
			backupDir="${backup.dir}"
			templateDir="../MDAGenerator/templates/"
			modelFile="${model.dir}/dummy2.xmi">
			
			<classGenerator name="test/class" extension="txt"/>
			<classGenerator name="java/interface" extension="java"/>
			<classGenerator name="java/class" suffix="Impl" extension="java"/>
			<classGenerator name="mvc/controller" suffix="Controller" extension="java"/>
			<classGenerator name="mvc/view" suffix="View" extension="java"/>
			<classGenerator name="ejb/entitybean" suffix="Bean" extension="java" stereotype="entity"/>
			<classGenerator name="ejb/sessionbean" suffix="Bean" extension="java" stereotype="service"/>
			<classGenerator name="doc/classdot" extension="dot"/>
			<packageGenerator name="doc/packagedot" extension="dot">
				<!--includeStereotype name="entity"/>
				<excludeStereotype name="extern"/-->
			</packageGenerator>
			<modelGenerator name="db/create_table_ddl" basename="create_tables" extension="sql"/>
			<modelGenerator name="db/drop_table_ddl" basename="drop_tables" extension="sql"/>
			<modelGenerator name="xml/schema" basename="model" extension="xsd"/>
			<modelgenerator name="doc/htmldoc" basename="model" extension="html"/>
			<modelgenerator name="hibernate/mapping" basename="model" extension="hbm.xml"/>
		</mdaGenerator>
		
		<!-- create UML diagrams from generated .dot files -->
		<mkdir dir="${generate.dir}/img"/>
		<apply executable="/usr/bin/dot" dest="${generate.dir}">
			<arg value="-Tgif"/>
			<srcfile/>
			<arg value="-o"/>
			<targetfile/>
			<fileset dir="${generate.dir}" includes="**/*.dot"/>
			<mapper type="glob" from="*.dot" to="*.gif"/>
		</apply>
	</target>

</project>